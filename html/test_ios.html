<!DOCTYPE html>
<html>
<head>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name = "viewport" content = "user-scalable=no, width=device-width" />
	<title>ChesterGL iOS Demo</title>
	
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
	<script type="text/javascript" src="externals/glMatrix-0.9.5.min.js"></script>
	<script type="text/javascript" src="externals/base64.js"></script>
	<script type="text/javascript" src="chester.js"></script>
	<!-- audio!! -->
    <script type="text/javascript">

$(document).ready(function () {
	setTimeout(function() { window.scrollTo(0, 1) }, 100);
	
	// not working on full screen?
	// if (window.navigator.standalone) {
		setupGame();
	// } else {
	// 	$("#errors").css('display', 'block');
	// 	$("#demo-canvas").css('display', 'none');
	// }
	
	function setupGame() {
		// set to false to force canvas mode
		// ChesterGL.webglMode = false;
		ChesterGL.setup("demo-canvas");
		var width = ChesterGL.gl.viewportWidth;
		var height = ChesterGL.gl.viewportHeight;

		ChesterGL.loadAsset("texture", "images/test.png");
		ChesterGL.loadAsset("texture", "images/star.png");
		ChesterGL.assetsLoaded("texture", function () {
			// $("#loading").html("Test Single Block");        	
			// finish with the setup and run the game
			ChesterGL.setupPerspective();
			
			var sceneBlock = ChesterGL.Block.create();
			// no render for this block
			sceneBlock.render = function () {};			
			ChesterGL.rootBlock = sceneBlock;
			
			// add lots of blocks
			for (var i=0; i < 10; i++) {
				var b = ChesterGL.Block.create();
				b.setTexture("images/star.png");
				b.moveTo(Math.random() * width, Math.random() * height);
				b.speed = [Math.random() * 10 - 5, Math.random() * 10 - 5];
				b.update = function () {
					this.moveBy(this.speed[0], this.speed[1]);
					if (this.position.x >= width || this.position.x <= 0) { this.speed[0] = -this.speed[0]; }
					if (this.position.y >= width || this.position.y <= 0) { this.speed[1] = -this.speed[1]; }
				}
				sceneBlock.addChild(b);
			}
			
			// create a block
			var someBlock = ChesterGL.Block.create();
			someBlock.setTexture("images/test.png")
			// someBlock.rotateBy(45);
			someBlock.moveTo(width/2, height/2);
			
			var someBlock2 = ChesterGL.Block.create();
			someBlock2.setTexture("images/star.png");
			someBlock2.opacity = 0.5;
			someBlock2.moveTo(60, 0);
			someBlock.addChild(someBlock2);
			
			sceneBlock.addChild(someBlock);
			
			// add some action
			someBlock.update = function () {
				this.rotateBy(1);
			};
			someBlock2.update = function () {
				this.rotateBy(-1);
			};
			
			$("#next-frame").click(function () {
				ChesterGL.drawScene();
			});
			$("#clear-frame").click(function () {
				ChesterGL.gl.fillRect(0, 0, width, height);
			});
			
			ChesterGL.run();
			// draw a single frame (for debug purposes)
			// ChesterGL.drawScene();
		});
	} // setupGame()
	
	$("#debug-fps").click(function () {
		document.location = document.location;
	});
});
    </script>
    <style type="text/css">
#errors {
	display: none;
	width: 320px;
	height: 420px;
}
#errors h1 {
	font-family: helvetica;
	font-size: 18pt;
	padding: 5px;
	text-align: center;
}
#debug-fps {
	height: 20px;
}
body {
	padding: 0;
	margin: 0;
}
    </style>
</head>
<body>
	<div id="errors" style="display: none;">
		<h1>Please add this page to the homescreen before running</h1>
	</div>
	<div>
		<canvas id="demo-canvas" width="320" height="440"></canvas><br/>
		<span id="debug-fps">reload</span>
	</div>
</body>
</html>
