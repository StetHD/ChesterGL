<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="test.css"/>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
	<script type="text/javascript" src="externals/glMatrix-1.0.0.min.js"></script>
	<script type="text/javascript" src="externals/base64.js"></script>
	<!-- <script type="text/javascript" src="externals/webgl-debug.js"></script> -->
	<script type="text/javascript" src="chester.js"></script>
    <script type="text/javascript">

$(document).ready(function () {
	setupGame();

	function setupGame() {
		ChesterGL.useGoogleAnalytics = true;
		ChesterGL.setup("demo-canvas");
		var width = ChesterGL.gl.viewportWidth;
		var height = ChesterGL.gl.viewportHeight;
		
		ChesterGL.BlockFrames.loadFrames("images/1945.json");
		ChesterGL.loadAsset("texture", "images/test.png");
		ChesterGL.loadAsset("texture", "images/star.png");
		ChesterGL.assetsLoaded('texture', function () {
			$("#loading").html("Test Sprite Sheets");  	
			// finish with the setup and run the game
			ChesterGL.setupPerspective();
			
			var sceneBlock = new ChesterGL.Block(null, ChesterGL.Block.TYPE.SCENE);
			sceneBlock.title = "Test::Actions";
			ChesterGL.runningScene = sceneBlock;
			
			// create a block with a block frame
			var b1 = new ChesterGL.Block("1945-4-0.png");
			b1.moveTo([width * 0.5, height * 0.5, 0]);

			var b2 = new ChesterGL.Block("1945-4-1.png");
			b2.moveTo([width *0.5 - 50, height * 0.5, 0]);
			
			sceneBlock.addChild(b1);
			sceneBlock.addChild(b2);
			
			// b1.update = function () {
			// 	this.rotateBy(1);
			// }

			ChesterGL.addMouseHandler(function (pt, type) {
				if (type == ChesterGL.mouseEvents.DOWN) {
					// calculate angle to destination and rotate that angle
					var sub = vec3.create();
					vec3.subtract(pt, b1.position, sub);
					var angle = Math.asin((pt[1] - b1.position[1]) / vec3.length(sub));
					if (pt[0] > b1.position[0]) {
						b1.rotateTo(90 - angle * ChesterGL.Block.RAD_TO_DEG);
					} else {
						b1.rotateTo(angle * ChesterGL.Block.RAD_TO_DEG - 90);
					}
					b1.moveTo(pt, 1.0);
				}
			});
			
			ChesterGL.run();
			// draw a single frame (for debug purposes)
			// ChesterGL.drawScene();
		});
	} // setupGame()
	
	var fullScreen = false;
	$("#fullScreen").click(function () {
		var canvas = document.getElementById("game-container");
		canvas.onwebkitfullscreenchange = function () {
			fullScreen = !fullScreen;
			console.log("we went full screen: " + fullScreen);
			canvas.webkitCancelFullScreen();
		}
		if (!fullScreen) {
			canvas.webkitRequestFullScreen();
		}
	});
	
});
    </script>
	<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-77863-9']);
_gaq.push(['_setDomainName', 'github.com']);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
	</script>
</head>
<body>
	<div id="loading" style="position: absolute; z-index: 100;"></div>
	<div id="game-container">
		<canvas id="demo-canvas" width="640" height="480"></canvas>
		<div>
			<input style="margin-left: auto; margin-right: auto;" type="button" value="Toggle Full Screen" id="fullScreen"/>
			<span id="debug-info">00</span> ms per frame
		</div>
	</div>
</body>
</html>
