<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
	<script type="text/javascript" src="externals/glMatrix-1.0.0.min.js"></script>
	<script type="text/javascript" src="externals/base64.js"></script>
	<!-- <script type="text/javascript" src="externals/webgl-debug.js"></script> -->
	<script type="text/javascript" src="chester.js"></script>
	<!-- audio!! -->
    <script type="text/javascript">

$(document).ready(function () {
	setupGame();

	function setupGame() {
		// set to false to force canvas mode
		// ChesterGL.webglMode = false;
		ChesterGL.useGoogleAnalytics = true;
		ChesterGL.setup("demo-canvas");
		var width = ChesterGL.gl.viewportWidth;
		var height = ChesterGL.gl.viewportHeight;

		ChesterGL.loadAsset("texture", "images/test.png");
		ChesterGL.loadAsset("texture", "images/star.png");
		ChesterGL.assetsLoaded("texture", function () {
			// $("#loading").html("Test Single Block");        	
			// finish with the setup and run the game
			ChesterGL.setupPerspective();
			
			var sceneBlock = new ChesterGL.Block();
			sceneBlock.title = "Test::CanvasFallback";
			ChesterGL.runningScene = sceneBlock;
			
			// add lots of blocks
			for (var i=0; i < 100; i++) {
				var b = new ChesterGL.Block();
				b.setTexture("images/star.png");
				b.moveTo([Math.random() * width, Math.random() * height, 0]);
				b.speed = [Math.random() * 10 - 5, Math.random() * 10 - 5];
				b.update = function () {
					this.moveBy([this.speed[0], this.speed[1], 0]);
					if (this.position[0] >= width || this.position[0] <= 0) { this.speed[0] = -this.speed[0]; }
					if (this.position[1] >= width || this.position[1] <= 0) { this.speed[1] = -this.speed[1]; }
				}
				sceneBlock.addChild(b);
			}
			
			// create a block
			var someBlock = new ChesterGL.Block();
			someBlock.setTexture("images/test.png")
			// someBlock.rotateBy(45);
			someBlock.moveTo([width/2, height/2, 0]);
			
			var someBlock2 = new ChesterGL.Block();
			someBlock2.setTexture("images/star.png");
			someBlock2.opacity = 0.5;
			someBlock2.moveTo([60, 0, 0]);
			someBlock.addChild(someBlock2);
			
			sceneBlock.addChild(someBlock);
			
			// add some action
			var dz = 2;
			someBlock.update = function () {
				this.rotateBy(1);
				// this will only work on webgl
				// we could, however fake this by changing the scale...
				this.moveBy([0, 0, dz]);
				if (this.position[2] >=  200) { dz = -dz; }
				if (this.position[2] <= -200) { dz = -dz; }
			};
			someBlock2.update = function () {
				this.rotateBy(-1);
			};
						
			ChesterGL.run();
			// draw a single frame (for debug purposes)
			// ChesterGL.drawScene();
		});
	} // setupGame()

	var scaled = false;
	$("#scaling").click(function () {
		if (scaled) {
			$("#demo-canvas").css('width', '500px');
			scaled = false;
		} else {
			$("#demo-canvas").css('width', '100%');
			scaled = true;
		}
	});
});
    </script>
    <style type="text/css">
body {
	margin: 0;
	padding: 0;
}
#loading {
    color: #fff;
    text-shadow: 2px 2px 2px #000;
    font-weight: bold;
    font-size: 18pt;
    padding: 1em;
}
#demo-canvas {
	margin-left: auto;
	margin-right: auto;
}
    </style>
	<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-77863-9']);
_gaq.push(['_setDomainName', 'github.com']);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
	</script>
</head>
<body onload="setTimeout(function() { window.scrollTo(0, 1) }, 100);">
	<div id="loading" style="position: absolute; z-index: 100;"></div>
	<div>
		<canvas id="demo-canvas" width="500" height="280"></canvas><br/>
	</div>
	<p><span id="debug-info">00</span> ms per frame</p>
	<div id="controls">
		<input type="button" value="Switch CSS Scaling" id="scaling"/>
	</div>
</body>
</html>
